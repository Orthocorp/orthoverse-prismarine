'use strict';

const Vec3 = require('vec3').Vec3;
const rand = require('random-seed')

function generation ({ version = '1.16.1', seed } = {}) {
  const size = 101*16*6
  const Chunk = require('prismarine-chunk')(version)
  const mcData = require('minecraft-data')(version)
  const majorVersion = mcData.version.majorVersion

  function generateSimpleChunk (chunkX, chunkY) {
    const chunk = new Chunk()
    const worldX = chunkX * 16 + size / 2
    const worldY = chunkY * 16 + size / 2
    const seedRand = rand.create(seed + ':' + chunkX + ':' + chunkY)
    const level = 20 + seedRand(2)

    for (let x = 0; x < 16; x++) {
      for (let y = 0; y < 16; y++) {
        const bedrockheight = 1 + seedRand(4)
        for (let z = 0; z < 256; z++) {
          let block
          let data
          if (z < bedrockheight) { 
            block = mcData.blocksByName.bedrock.id 
          } else if (z < level) {
            block = (seedRand(10) < 9) ? mcData.blocksByName.dirt.id : mcData.blocksByName.sand.id
          } else if (z === level) {
            block = mcData.blocksByName.grass_block.id  // Set surface sand/grass
            data = 1
          } else if (z === level + 1 && seedRand(10) === 0) {
            block = mcData.blocksByName.grass.id
          }
          const pos = new Vec3(x, z, y)
          if (block) { 
            chunk.setBlockType(pos, block)
          }
          if (data) {
            chunk.setBlockData(pos, data)
          }
          chunk.setSkyLight(pos, 15)
        }
      }
    }
    return chunk
  }

  return generateSimpleChunk
}



module.exports = generation;
